//////////////////////////////////////////////////////////
analytics.jsの記述方法について

2016.07.27
//////////////////////////////////////////////////////////

*----------------------------------------------------------*
◆初期バージョン
（analyticsから発行される初期コード）
*----------------------------------------------------------*
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-▲▲▲▲▲▲▲-▲', 'auto');
ga('send', 'pageview');
*----------------------------------------------------------*

*----------------------------------------------------------*
◆コード解説
*----------------------------------------------------------*

○デフォルトコードは下記2行のみ↓
+++++++++++++++++++++++++++++++++++++++++++++++++++++
ga('create', 'UA-▲▲▲▲▲▲▲-▲', 'auto');
ga('send', 'pageview');
+++++++++++++++++++++++++++++++++++++++++++++++++++++

○拡張アトリビューション、ディスプレイ広告設定が下記↓
　(analytics側の設定必要)
+++++++++++++++++++++++++++++++++++++++++++++++++++++
ga('require', 'displayfeatures');
ga('require', 'linkid', 'linkid.js')
+++++++++++++++++++++++++++++++++++++++++++++++++++++

○クロスドメイントラッキング用設定が下記↓
（※宿泊サイトで予約ページ遷移まで繋げる場合に必要。
　　観光サイト、ウェディングサイトなど、１ドメインの場合は不要。）
+++++++++++++++++++++++++++++++++++++++++++++++++++++
ga('create', 'UA-▲▲▲▲▲▲▲-▲', 'auto', {'allowLinker': true});
ga('require', 'linker');
ga('linker:autoLink', ['●●●●●●','●●●●●●●'], false, true);

※1行目に、「, {'allowLinker': true}」の記述が追記となります。
+++++++++++++++++++++++++++++++++++++++++++++++++++++


*----------------------------------------------------------*

上記を加えたフルバージョンが下記。
*----------------------------------------------------------*
◆フルバージョン
（拡張リンクアトリビューション、クロスドメイン、ディスプレイ広告設定）
*----------------------------------------------------------*
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-▲▲▲▲▲▲▲-▲', 'auto', {'allowLinker': true});
ga('require', 'displayfeatures');
ga('require', 'linkid', 'linkid.js');
ga('require', 'linker');
ga('linker:autoLink', ['●●●●●●','●●●●●●●'], false, true);
ga('send', 'pageview');
*----------------------------------------------------------*

*----------------------------------------------------------*
◆注意事項：クロスドメインの検索フォーム取得◆
*----------------------------------------------------------*
上記フルバージョン記述をしても、
日時検索のフォーム部分だけ、リンク後ページにga=・・・という
クロスドメインの値が付与されない場合があります。
（出る施設と出ない施設があり、原因は不明です）
その場合は、下記のjsコードを最下部に追記してください。

*----------------------------------------------------------*
function decorateForm(target) {
	ga(function(tracker) {
		var linker = new window.gaplugins.Linker(tracker);
		target.action = linker.decorate(target.action);
	});
}
*----------------------------------------------------------*

万が一、上記設定で検索フォームがクロスドメイン遷移しない場合、
下記アドレスへご相談ください。
webmarketing@ab-net.co.jp